(()=>{var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(t=n.currentScript.src),!t)){var r=n.getElementsByTagName("script");if(r.length)for(var c=r.length-1;c>-1&&(!t||!/^http(s?):/.test(t));)t=r[c--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();try{"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.getURL&&(e.p=chrome.runtime.getURL("/"))}catch(e){}let t=null,n=0,r=0,c=!1,o=null,a=null,i=null,s=null,u=null,d=null,l=!1,m=!1,p=0,h=1,f="",y=0,w="",v=null;async function g(e){if(e&&"suspended"===e.state)try{await e.resume()}catch(e){}}function b(){return document.querySelector("video")}async function k(){const e=b();if(!e)return!1;if(l)return await g(i),!0;try{if(i=i||new(window.AudioContext||window.webkitAudioContext),await g(i),!m)try{const e=chrome.runtime.getURL("pitch-shifter.worklet.js");await i.audioWorklet.addModule(e),m=!0}catch(e){return!1}if(s||(s=i.createMediaElementSource(e)),!d){d=i.createGain();const e=Math.max(0,Math.min(1,h));d.gain.value=e}u||(u=new AudioWorkletNode(i,"pitch-shifter-processor"));try{s.disconnect()}catch(e){}try{u.disconnect()}catch(e){}try{d.disconnect()}catch(e){}return s.connect(u),u.connect(d),d.connect(i.destination),e.muted=!0,e.addEventListener("play",async()=>{i&&await g(i)}),e.addEventListener("playing",async()=>{i&&await g(i)}),l=!0,!0}catch(e){return l=!1,!1}}function T(){const e=b();if(e)try{e.playbackRate=1,t&&(clearInterval(t),t=null),o&&(e.removeEventListener("ended",o),o=null),a&&(e.removeEventListener("timeupdate",a),a=null),n=0,r=e.duration||0,c=!1,p=0,P(),"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local&&chrome.storage.local.set({currentSpeed:1,currentPitch:0,loopStart:0,loopEnd:e.duration||0,isLoopEnabled:!0,isSpeedEnabled:!0,isPitchEnabled:!0},()=>{})}catch(e){}}function E(){const e=b();if(!e)return;const t=L(),n=e.currentTime,r=window.location.href;(t!==f&&""!==f||r!==w&&""!==w||n<y-10||n>y+30||y>5&&n<2)&&T(),f=t,y=n,w=r}function L(){const e=document.querySelector("h1.ytd-video-primary-info-renderer")||document.querySelector("h1.title")||document.querySelector(".watch-main-col h1");return e?e.textContent.trim():"Unknown Video"}async function S(e){return await async function(e){const t=Math.max(-24,Math.min(24,e));p=t;const n=b();if(!n)return!1;if(!l&&!await k())return!1;try{if(u&&u.parameters){const e=u.parameters.get("semitones");e&&(e.value=t)}return n.playbackRate=1,!0}catch(e){return!1}}(e)}function P(){const e=b();if(!e)return!1;try{return p=0,l&&(e.muted=!1),!0}catch(e){return!1}}"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((e,s,u)=>{if("about:blank"===window.location.href||!document)return u({success:!1,error:"Invalid execution context"}),!1;try{switch(e.action){case"getVideoInfo":const s=function(){const e=b();return e?{duration:e.duration||0,currentTime:e.currentTime||0,title:L(),isPlaying:!e.paused}:null}();u({success:!!s,...s});break;case"getVideoState":const l=b();if(l){const e=d&&d.gain&&"number"==typeof d.gain.value?d.gain.value:h;u({success:!0,isPlaying:!l.paused,volume:e,currentTime:l.currentTime,duration:l.duration,speed:l.playbackRate,pitch:p,loop:{start:n,end:r,enabled:c}})}else u({success:!1});break;case"getVideoInfo":const m=b();if(m){const e=L(),t=window.location.href;u({success:!0,title:e,url:t,duration:m.duration,currentTime:m.currentTime})}else u({success:!1,error:"No video found"});break;case"togglePlayPause":const f=b();f?(f.paused?f.play():f.pause(),u({success:!0})):u({success:!1,error:"No video found"});break;case"setVolume":const y=b();if(y){const t=Math.max(0,Math.min(1,e.volume));h=t,d&&d.gain?d.gain.value=t:y.volume=t,u({success:!0})}else u({success:!1});break;case"setPlaybackRate":const w=function(e){const t=b();return!!t&&(t.playbackRate=e,!0)}(e.speed);u({success:w});break;case"seekTo":return(async()=>{const t=await async function(e){const t=b();return!!t&&(t.currentTime=e,i&&await g(i),!0)}(e.time);u({success:t})})(),!0;case"setLoop":const v=function(e,i,s){const u=b();return!(!u||(t&&(clearInterval(t),t=null),o&&(u.removeEventListener("ended",o),o=null),a&&(u.removeEventListener("timeupdate",a),a=null),s?e>=i||e<0||i>u.duration||(i>=u.duration-1&&0===e?(c=!1,0):(n=e,r=Math.min(i,u.duration-1),c=!0,o=e=>{if(c)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),u.currentTime=n,u.play().catch(()=>{}),!1},u.addEventListener("ended",o,{capture:!0,passive:!1}),a=()=>{if(!c||u.paused)return;const e=u.currentTime;(e>=r-.5||e<n)&&(u.currentTime=n)},u.addEventListener("timeupdate",a),t=setInterval(()=>{if(!u||u.paused||!c)return;const e=u.currentTime;e>=r-.5&&(u.currentTime=n),e>=u.duration-1&&(u.currentTime=n)},30),0)):(c=!1,0)))}(e.start,e.end,e.enabled);u({success:v});break;case"setPitch":return(async()=>{const t=await S(e.pitch);u({success:t,currentPitch:p})})(),!0;case"initializePitch":return(async()=>{const e=await k();u({success:e})})(),!0;case"disablePitch":const E=P();u({success:E});break;case"resetAll":T(),u({success:!0});break;default:u({success:!1,error:"Unknown action"})}}catch(e){u({success:!1,error:e.message})}}),function(){"use strict";try{if("about:blank"===window.location.href||window!==window.top||!document||"loading"===document.readyState)return;if(!window.location.hostname.includes("youtube.com"))return;function e(){return!!document.querySelector("video")&&(function(){v&&clearInterval(v),f=L(),w=window.location.href;const e=b();y=e?e.currentTime:0,e&&e.addEventListener("ended",()=>{c||setTimeout(E,1e3)}),v=setInterval(E,2e3)}(),!0)}"complete"===document.readyState?e():(document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e))}catch(t){}}()})();