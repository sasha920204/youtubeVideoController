(()=>{var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(t=n.currentScript.src),!t)){var r=n.getElementsByTagName("script");if(r.length)for(var c=r.length-1;c>-1&&(!t||!/^http(s?):/.test(t));)t=r[c--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();try{"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.getURL&&(e.p=chrome.runtime.getURL("/"))}catch(e){}let t=null,n=0,r=0,c=!1,a=null,o=null,i=null,s=null,u=null,l=null,d=!1,m=!1,p=0,h=1,f="",y=0,w=null;async function v(e){if(e&&"suspended"===e.state)try{await e.resume()}catch(e){}}function g(){return document.querySelector("video")}async function b(){const e=g();if(!e)return!1;if(d)return await v(i),!0;try{if(i=i||new(window.AudioContext||window.webkitAudioContext),await v(i),!m)try{const e=chrome.runtime.getURL("pitch-shifter.worklet.js");await i.audioWorklet.addModule(e),m=!0}catch(e){return!1}if(s||(s=i.createMediaElementSource(e)),!l){l=i.createGain();const e=Math.max(0,Math.min(1,h));l.gain.value=e}u||(u=new AudioWorkletNode(i,"pitch-shifter-processor"));try{s.disconnect()}catch(e){}try{u.disconnect()}catch(e){}try{l.disconnect()}catch(e){}return s.connect(u),u.connect(l),l.connect(i.destination),e.muted=!0,e.addEventListener("play",async()=>{i&&await v(i)}),e.addEventListener("playing",async()=>{i&&await v(i)}),d=!0,!0}catch(e){return d=!1,!1}}function k(){const e=g();if(e)try{e.playbackRate=1,t&&(clearInterval(t),t=null),a&&(e.removeEventListener("ended",a),a=null),o&&(e.removeEventListener("timeupdate",o),o=null),n=0,r=e.duration||0,c=!1,p=0,S(),"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local&&chrome.storage.local.set({currentSpeed:1,currentPitch:0,loopStart:0,loopEnd:e.duration||0,isLoopEnabled:!0,isSpeedEnabled:!0,isPitchEnabled:!0},()=>{})}catch(e){}}function T(){const e=g();if(!e)return;const t=E(),n=e.currentTime;(t!==f&&""!==f||n<y-30||n>y+60)&&k(),f=t,y=n}function E(){const e=document.querySelector("h1.ytd-video-primary-info-renderer")||document.querySelector("h1.title")||document.querySelector(".watch-main-col h1");return e?e.textContent.trim():"Unknown Video"}async function L(e){return await async function(e){const t=Math.max(-24,Math.min(24,e));p=t;const n=g();if(!n)return!1;if(!d&&!await b())return!1;try{if(u&&u.parameters){const e=u.parameters.get("semitones");e&&(e.value=t)}return n.playbackRate=1,!0}catch(e){return!1}}(e)}function S(){const e=g();if(!e)return!1;try{return p=0,d&&(e.muted=!1),!0}catch(e){return!1}}"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((e,s,u)=>{if("about:blank"===window.location.href||!document)return u({success:!1,error:"Invalid execution context"}),!1;try{switch(e.action){case"getVideoInfo":const s=function(){const e=g();return e?{duration:e.duration||0,currentTime:e.currentTime||0,title:E(),isPlaying:!e.paused}:null}();u({success:!!s,...s});break;case"getVideoState":const d=g();if(d){const e=l&&l.gain&&"number"==typeof l.gain.value?l.gain.value:h;u({success:!0,isPlaying:!d.paused,volume:e,currentTime:d.currentTime,duration:d.duration,speed:d.playbackRate,pitch:p,loop:{start:n,end:r,enabled:c}})}else u({success:!1});break;case"getVideoInfo":const m=g();if(m){const e=E(),t=window.location.href;u({success:!0,title:e,url:t,duration:m.duration,currentTime:m.currentTime})}else u({success:!1,error:"No video found"});break;case"togglePlayPause":const f=g();f?(f.paused?f.play():f.pause(),u({success:!0})):u({success:!1,error:"No video found"});break;case"setVolume":const y=g();if(y){const t=Math.max(0,Math.min(1,e.volume));h=t,l&&l.gain?l.gain.value=t:y.volume=t,u({success:!0})}else u({success:!1});break;case"setPlaybackRate":const w=function(e){const t=g();return!!t&&(t.playbackRate=e,!0)}(e.speed);u({success:w});break;case"seekTo":return(async()=>{const t=await async function(e){const t=g();return!!t&&(t.currentTime=e,i&&await v(i),!0)}(e.time);u({success:t})})(),!0;case"setLoop":const T=function(e,i,s){const u=g();return!(!u||(t&&(clearInterval(t),t=null),a&&(u.removeEventListener("ended",a),a=null),o&&(u.removeEventListener("timeupdate",o),o=null),s?e>=i||e<0||i>u.duration||(i>=u.duration-.5&&0===e?(c=!1,0):(n=e,r=Math.min(i,u.duration-.5),c=!0,a=e=>{if(c)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),u.currentTime=n,u.play().catch(()=>{}),!1},u.addEventListener("ended",a,!0),o=()=>{if(!c||u.paused)return;const e=u.currentTime;(e>=r-.3||e>=r||e<n)&&(u.currentTime=n)},u.addEventListener("timeupdate",o),t=setInterval(()=>{u&&!u.paused&&c&&u.currentTime>=r&&(u.currentTime=n)},50),0)):(c=!1,0)))}(e.start,e.end,e.enabled);u({success:T});break;case"setPitch":return(async()=>{const t=await L(e.pitch);u({success:t,currentPitch:p})})(),!0;case"initializePitch":return(async()=>{const e=await b();u({success:e})})(),!0;case"disablePitch":const P=S();u({success:P});break;case"resetAll":k(),u({success:!0});break;default:u({success:!1,error:"Unknown action"})}}catch(e){u({success:!1,error:e.message})}}),function(){"use strict";try{if("about:blank"===window.location.href||window!==window.top||!document||"loading"===document.readyState)return;if(!window.location.hostname.includes("youtube.com"))return;function e(){return!!document.querySelector("video")&&(function(){w&&clearInterval(w),f=E();const e=g();y=e?e.currentTime:0,w=setInterval(T,5e3)}(),!0)}"complete"===document.readyState?e():(document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e))}catch(t){}}()})();